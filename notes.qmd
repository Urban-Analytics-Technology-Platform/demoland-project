# Notes

---

This page is constantly updated on an (almost) daily base, meaning that the order is not dictated by a specific structure, just temporary adding up ideas and development of the project.

NB: in reverse order, that is more recent stuff is at the top of the document.


## November

Need to fine-tune things after last talk with Dani (end of October).<br/>
Instead of trying to reproduce [carbon.place results](#did-someone-already-do-this), we want to produce a <mark>**Land Use regression model**</mark> $\rightarrow$ **LUR**

---

1. Generally used for air quality prediction <br/>
...FIND examples of non-air pollutants applications?

2. LUR potential predictor variables extraction ... relevant for us? (limited number of variables)
$\rightarrow$ _ideally we'd like to perform this as well_

3. LUR output is raster VS vectorial $\rightarrow$ _we'll need to aggregate the data at some spatial level (MSOAs for instance), introducing some level of approximation_

4. not clear how the _spatial_ connotation enter the model, just because we use data defined at (some) geographic level?

### Variables creation

We search now for data to be used as variables (land use features) to predict 4 indicators (see Intro [here ](intro.qmd#indicators-building)):

- _1.a/b_. Pollution/emissions

data for actual GHG emissions (total, IE comprehensive of mobility, housing, etc) is [only at LAD level](#data-availability)

- _1.c_. Green space accessibility

how do we calculate the distance to the nearest green space... or the entrance gate (tricky)

- _2.b_. Jobs accessibility

We don't have actual data (??) for jobs accessibility but we need to create the variable ourselves... so what's the point in modelling it?

- _2.c_. House prices

what scenario on house prices?

### Some literature on LUR

- [https://en.wikipedia.org/wiki/Land_use_regression_model](https://en.wikipedia.org/wiki/Land_use_regression_model)
<blockquote>
A raster graphic image of the area is generated and intersected with area-level population data to formulate the exposure distribution.
</blockquote>

- [Hoek et al., 2008](https://www.sciencedirect.com/science/article/abs/pii/S1352231008005748) "A review of land-use regression models to assess spatial variation of outdoor air pollution" <br\>
They review 25 land-use regression studies.<br\>
<blockquote>
Application of the land-use regression approach for air pollution mapping was introduced in the SAVIAH (Small Area Variations In Air quality and Health) study (Briggs et al., 1997).  The technique was initially termed regression mapping
</blockquote>
<blockquote>
Land-use regression combines monitoring of air pollution at typically 20–100 locations, spread over the study area, and development of stochastic models using predictor variables usually obtained through geographic information systems (GIS)
</blockquote>
<blockquote>
main components of LUR: monitoring data, geographic predictors and model development and validation
</blockquote>

- [Bertazzon et al., 2015](https://www.sciencedirect.com/science/article/pii/S1877584515000325?via%3Dihub) "Accounting for spatial effects in land use regression for urban air pollution modeling"

<blockquote>
LUR models are described by standard regression equations. Over the past decade, land use regression (LUR) modeling has emerged as a preferred method for assessing exposure to spatially heterogeneous pollutants, including NO2 (Health Effects Institute, 2010). Despite their advantages, LUR models rely on spatial data; therefore, they are subject to the spatial effects associated with the properties of these data.
</blockquote>

- [Morley and Gulliber, 2018](https://github.com/dwmorley/RLUR)"A land use regression variable generation, modelling and prediction tool for air pollution exposure assessment"

<mark>RLUR</mark> software to develop LUR model in R;<br/>
Open-source code available in [GitHub](https://github.com/dwmorley/RLUR);<br/>
GUI with visualisation tools

- [Ma et al. 2020](https://www.researchgate.net/publication/339851484_PyLUR_Efficient_software_for_land_use_regression_modeling_the_spatial_distribution_of_air_pollutants_using_GDALOGR_library_in_Python) "<mark>PyLUR</mark>: efficient software for land use regression modelling the spatial distribution of air pollutants using GDAL/OGR library in Python"

<blockquote>
Although conceptually quite simple, its successful implementation requires detailed knowledge of the area, expertise in GIS, statistics, and programming skills, which makes this modelling approach **relatively inaccessible to novice users**.
</blockquote>

<blockquote>
PyLUR out-performs <mark>RLUR</mark> for modelling in the Bradford and Auckland case studies examined. Furthermore, PyLUR is much more efficient in data processing and it has a capability to handle detailed GIS input data.</blockquote>

<blockquote>
<sub><sup>The principles of LUR modelling can be summarized in **five steps**. **First**, air pollution monitoring and GIS data are collected within the scope of the study area. **Secondly**, different kinds of potential predictor variables for each site are generated using GIS buffering or other geospatial analysis methods. **Thirdly**, multiple regression analysis is carried out to develop one regression equation establishing the relationship between the observed air pollutant concentrations and significant predictor variables selected from a pool of all potential predictor variables. **Fourthly**, model performance is evaluated using holdout or cross-validation. **Finally*, once the model is successfully validated, it can be applied to predict the concentration at un-sampled points of interest or generate an air pollutant concentration map of the whole study area (Morley and Gulliver, 2018).</sup></sub>
</blockquote>

- [Molter and Lindley, 2021](https://www.sciencedirect.com/science/article/pii/S1364815221001511) "Developing land use regression models for environmental science research using the <mark>XLUR</mark> tool – More than a one-trick pony"

<blockquote>A Python toolbox for ArcGIS Pro that enables the development and application of land use regression models</blockquote>
... relevant for literature (it's developed for ArcGIS, so no use)

### Theoretical framework

In a general non-linear linear regression model we have a given dependent variable which we try to explain by several independent explanatory variables. <br/>
In our case for a LUR model we have, considering GHG emissions from mobility or housing:

| | | |
|-|-|-|
| Dependent variable     | actual data for GHG emissions       | |
| Explanatory variables  | landuse variables |(ex. n. of trips, distance, <br> mode of transport...)  |

*Formulas here*

### LUR in Python

- check out this blog [How to Build a Regression Model in Python](https://towardsdatascience.com/how-to-build-a-regression-model-in-python-9a10685c7f09)

- Geographic Data Science with Python, book [Chap. 11, Spatial Regression](https://geographicdata.science/book/notebooks/11_regression.html)

- Paper [PyLUR: Efficient software for land use regression modeling the spatial distribution of air pollutants using GDAL/OGR library in Python](https://link.springer.com/article/10.1007/s11783-020-1221-5) <br/>
Note the code is available online on ResearchGate [here](https://www.researchgate.net/publication/339851484_PyLUR_Efficient_software_for_land_use_regression_modeling_the_spatial_distribution_of_air_pollutants_using_GDALOGR_library_in_Python) (find “linked data” tab)


### Facts on GHG emissions

Governmental report [UK local authority and regional greenhouse gas emissions national statistics, 2005 to 2020](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1086967/uk-local-regional-greenhouse-gas-emissions-2005-2020-release.pdf)


## October

**Initial trials**

Working on *a. mobility based emissions* $\rightarrow$ IE transport data

\&

Building *base scenario*

Roadmap:

- [X] Try to dl/open/visualise SPC data $\rightarrow$ *Note: study case Metropolitan county of Tyne and Wear*
- [ ] Investigate potentially relevant data from [UK Data Services](#people-behavior) data $\rightarrow$ any other relevant dataset?
- [ ] How to connect/integrate TUS to SPC dataset -- why?
- [ ] visualise the integrated dataset $\rightarrow$ *base scenario*
- [ ] think "future scenarios"

![](images/tynewear_county_lads.png)
*The 5 LADs in the Metropolitan County of Tyne and Wear, highlighted are also the 4 major town areas*


---

**Keep in mind when you'll "generalise" the procedure**

*IE pass from the study case to a national case*

- how to select MSOAs for Origin and Destination from the dataset (take off abroad destinations as well)

- 

---

### Defining relations

We can see the Indicators $I_{i}$, with $i = \{1, ..., n\}$, as a function of different land uses $l_{j}$ where $j = \{1, ..., k\}$ and $I_{i}$ can be expressed as generic mathematical relation (that we express with the symbol "$\star$"") between several $l_{j}$ weighted by $k$ generic weights/parameters $w_{j}$, as follows:

$$I_{i}(l) = w_1^il_{1} \star  w_2^il_{2} \dots \star w_k^il_{k}$$

Different indicators can depend on same landuse variables, and per each indicator the scenarios can be expressed by acting on the paramters $w_{j}$.

As an example, using the definition above the indicator Mobility based emissions (a.) could be expressed **for commuting trips** <mark>per mode of transport</mark> and per each MSOA as:

<!-- $[\textit{emissions/ msoa / year}] = w_1[trips/day] \star w_2[distance/trip] \star w_3[n\_individuals] \star w_4[n\_commuting days/year] \star w_5[\textit{CO}_2 \textit{k}]$ -->

$$
\begin{align}
[\textit{emissions/msoa/year}] & =  w_1[trips/day] \star\\
& \star  w_2[distance/trip] \star\\
& \star  w_3[n\_individuals] \star\\
& \star  w_4[\textit{n of commuting days/year}] \star \\
& \star w_5[\textit{CO}_2 \textit{k}]
\end{align}
$$

where:

- $[trips/day]$ is a fixed value (average per person from DFT data ... *)
- $[distance/trip]$ is calculated as shortest distance between the MSOAs' centroids
- $[n\_individuals]$ is given by the UK Census 2011 commuting flow
- $[\textit{n of commuting days/year}]$ is a fixed value (average per person from DFT data ... *)
- $[CO_2 k]$ is the carbon dioxide equivalent emission factor per mode of transport

### Working questions:

- [ ] which year to take into consideration for the analysis? (Census, conversion factors, surveys...)

- [ ] when I calculate the distance home-place of work, how do I consider the intraMSOA trips (IE within the same MSOA), as I am only taking into account the centroids of the MSOAs?

- [ ] how we count total number of people (age, people working)

- [ ] do we give the results per capita (then see point above) or total per MSOA

- [ ] how many hours for the working from home people (not counting for now, as not using transport)

---

### Approximations

a. only OD within MSOAs of this county 

b. considering as distance only the pop weighted centroids for each MSOA

c. London has specific values for CO2 conversion factors (ex for cabs, buses, underground) but only using general values (correct later if needed for London case)

d. ...

---

Commuting is really just one part of the total travels by car per per person per year:

![](images/car_trips_per_person_travel_survey.png)
*source: [national travel  survey](https://www.gov.uk/government/statistics/national-travel-survey-2020/national-travel-survey-2020)*

... it sounds then reductive to consider only commuting trips for emissions!

---

### Python code

**Note:** first trials in R, as I am more confident with the language, and trying to reproduce the code from carbun calculator for [prep_travel_to_work.R](https://github.com/creds2/CarbonCalculator/blob/master/R/prep_travel_to_work.R),

will then translate to Python

- Remember to add in *READ_ME* a walkthrough.

- Using `env.yml` $\dots$ *use `conda` or `poetry`?*



### Preliminary results

*Origin Destination flows of individuals for commuting to work (2011 UK Census data), the Metropolitan County of Tyne and Wear, separated by mode of transport*
![](images/od_tynewear_bymode.png)

*Preliminary results for GHG emissions from cars, total per MSOA per year in Tyne and Wear*
![](images/results_tynewear_car_emis_prelim.png)



## September

**Exploratory phase**

The idea is to focus on a few indicators (one or two) in order generate a *methodology* to apply to different variables (IE all the rest of indicators)

Concentrating on Indicators for [Net-zero a and b](intro.qmd#net-zero):

- a. *mobility based emissions* ... integration with SPC $/$ AB-street?

- b. *housing based emissions*


### Data availability

---

1. ~~(aggregated at LAD level) UK GHG emissions national statistics, estimates per Local Authority [Data for 2005 - 2020](https://www.gov.uk/government/statistics/uk-local-authority-and-regional-greenhouse-gas-emissions-national-statistics-2005-to-2020)~~ $\rightarrow$  this datum is a sum of emissions from 2005-2020


---

#### a. mobility based emissions

1. we can get from gov.uk CO<sub>2</sub>e (carbon dioxide equivalent) emissions factors for several occupations and travel modes, including transport, freight, etc [link](https://www.gov.uk/government/collections/government-conversion-factors-for-company-reporting);<br\>
We get the emission factors per mode of transport from the tab "Business travel-land" and "homeworking" (for working from home individuals)

2. OD flows from UK census ... **only to work and home**? *~~check source~~* $\rightarrow$ YES $\Downarrow$

3. get travel to school flow data from Propensity to Cycle Tool [PCT](https://www.pct.bike/m/)?

4. Location of usual residence and place of work by method of travel to work (...origin destination flows)
~~table WU03UK](https://wicid.ukdataservice.ac.uk/cider/wicid/downloads.php) at LAD level \
 *Note:* can download all the tables for "Location of usual residence and place of work by method of travel to work" at different levels (LAD to LSOA, though the lattest is not Open data) here https://wicid.ukdataservice.ac.uk/cider/about/data_int.php?type=2~~  <br\> **safeguarded data!!** git sttuslet's find <mark>MSOA</mark> data: <br\>
[nomisweb](Location of usual residence and place of work by method of travel to work)

- WU03BEW(with 'outside UK' detailed) **safeguarded**

- WU03EW (with 'outside UK' collapsed) **open**

---

#### b. housing based emissions
Sub-national electricity and gad consumption data, [overview link](https://www.gov.uk/government/statistical-data-sets/stacked-electricity-consumption-statistics-data)


- [electricity consumption](https://www.gov.uk/government/collections/sub-national-electricity-consumption-data):

a. one table per year (20105 to 2020) of total consumption at region and LAD levels [link](https://www.gov.uk/government/statistical-data-sets/regional-and-local-authority-electricity-consumption-statistics)

b. one table per year (2010 to 2020) of total consumption at LSOA or MSOA level [link](https://www.gov.uk/government/statistics/lower-and-middle-super-output-areas-electricity-consumption)

c. electricity and gas consumption (kWh) at postcode level (England, Scotland, Wales), one table per year, 2013,2015-2020 [Experimental](https://www.gov.uk/government/publications/postcode-level-domestic-gas-and-electricity-consumption-about-the-data)

d. electricity consumption data for 2005 to 2020 as a single table, with years stacked one above the other [stacked data](https://www.gov.uk/government/statistical-data-sets/stacked-electricity-consumption-statistics-data)

- analogous links for [gas consumption](https://www.gov.uk/government/collections/sub-national-gas-consumption-data) 

---

#### People behavior

People behavior and time use from *The UK Time Diary Study 2014 - 2015* - UK Time Use Survey carried by NatCen and available from [UK Data Service](https://ukdataservice.ac.uk/)

what we can get from this source: time people spend in different activities, mode of transport (yes?)

### Did someone already do this?


[carbon.place](https://www.carbon.place/)

Project from Malcom Morgan (Univ of Leeds) ...

> The PBCC estimates the average carbon footprint per person for each LSOA in England


**NOTE:**

cool project, GitHub code available but not reproducible (?)

opened issue here [https://github.com/creds2/CarbonCalculator/issues/6](https://github.com/creds2/CarbonCalculator/issues/6)




## Open general questions
*And plausible answer*


- [X] importance of localised emissions and need for air-flow modelling ... *not relevant for GHG*

- [X] what is the Research Question $\rightarrow$ *What are the "best" values in the parametrisation of the land use variables? Could we train the computer to predict these values?*

- [X] Resolution  ~~LSOAS/~~ *MSOAS* ? feedback from Dani regarding SS: *SS gives conversion to LSOAs* $\Downarrow$

- [X] how to generate scenarios - *ideas: change parameters' range/values, run ABstreet simulations...?*

- [X] integrate with SPC -  *need to integrate more Census variables? feasible?*

- [ ] Use SPC (individuals' level data) as we aggregate at MSOA level... what variables are meaningful when aggregated?

- [ ] can we actually build a methodology, given the different range of indicators and data?

- [ ] how turn on/off scenarios in the visualisation- *different layers in the map*

- [ ] type of output - *map, web ...* ~~MapBox~~ *MapLibre GL, Leaflet, ...*


---

### Output / map generation

Note: could generate a website via [MapLibre](https://maplibre.org/), checked the options

<!-- Let's see if [this map link](map_again.html) works  -->

<!-- What about a nested map

<link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/maplibre-gl-js-docs/assets/favicon/apple-touch-icon.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/maplibre-gl-js-docs/assets/favicon/favicon-32x32.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/maplibre-gl-js-docs/assets/favicon/favicon-16x16.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="manifest" href="/maplibre-gl-js-docs/assets/favicon/site.webmanifest?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="mask-icon" href="/maplibre-gl-js-docs/assets/favicon/safari-pinned-tab.svg?v=rMBbQAR5BL" color="#4264fb"/><link data-react-helmet="true" rel="shortcut icon" href="/maplibre-gl-js-docs/assets/favicon/favicon.ico?v=rMBbQAR5BL"/> -->
