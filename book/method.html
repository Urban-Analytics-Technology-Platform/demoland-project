<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Land Use Demonstrator - 3&nbsp; Methodology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../book/scenarios.html" rel="next">
<link href="../book/data_sources.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../book/method.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Land Use Demonstrator</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/ciupava/LandUseDemonstrator/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../Land-Use-Demonstrator.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/data_sources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data sources</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/method.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/scenarios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scenarios</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/01_baseline/01_accessibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Measuring accessibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/01_baseline/01b_greeenspace_datacleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Green space data cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/01_baseline/02_air_quality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Air quality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/01_baseline/03_house_prices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">House price</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/01_explanatory_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Authoritative table of explanatory variables on the Output Area level</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/01b_latent_sentinel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Sentinel 2 latent representation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/02_collinearity_filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Filter collinear explanatory variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/03_england-wide-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Training data sampled from the whole England</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/04a_air_quality_model_exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Air Quality prediction model exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/04b_air_quality_model_search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Air Quality prediction model search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/04c_air_quality_model_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Air quality model training</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/05a_house_price_model_exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">House Price prediction model exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/05b_house_price_model_search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">M</span>&nbsp; <span class="chapter-title">House price prediction model search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/02_models/05c_house_price_model_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">N</span>&nbsp; <span class="chapter-title">House price model training</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/03_prediction/01_summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">O</span>&nbsp; <span class="chapter-title">Create summary data for signatures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/03_prediction/02_sample_exvars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">P</span>&nbsp; <span class="chapter-title">Sample explanatory variables based on empirical data and custom scenario definition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/03_prediction/03_inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">Q</span>&nbsp; <span class="chapter-title">Air quality and house price model inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/03_prediction/04_acc_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">R</span>&nbsp; <span class="chapter-title">Accessibility API</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#indicator-selection" id="toc-indicator-selection" class="nav-link active" data-scroll-target="#indicator-selection"><span class="header-section-number">3.1</span> Indicator selection</a>
  <ul class="collapse">
  <li><a href="#accessibility-calculation" id="toc-accessibility-calculation" class="nav-link" data-scroll-target="#accessibility-calculation"><span class="header-section-number">3.1.1</span> Accessibility calculation</a></li>
  <li><a href="#air-quality-index" id="toc-air-quality-index" class="nav-link" data-scroll-target="#air-quality-index"><span class="header-section-number">3.1.2</span> Air quality index</a></li>
  <li><a href="#house-price" id="toc-house-price" class="nav-link" data-scroll-target="#house-price"><span class="header-section-number">3.1.3</span> House price</a></li>
  </ul></li>
  <li><a href="#explanatory-variables" id="toc-explanatory-variables" class="nav-link" data-scroll-target="#explanatory-variables"><span class="header-section-number">3.2</span> Explanatory variables</a>
  <ul class="collapse">
  <li><a href="#group-1-ons-population-estimates" id="toc-group-1-ons-population-estimates" class="nav-link" data-scroll-target="#group-1-ons-population-estimates"><span class="header-section-number">3.2.1</span> Group 1: ONS population estimates</a></li>
  <li><a href="#group-2-workplace-population-by-industry" id="toc-group-2-workplace-population-by-industry" class="nav-link" data-scroll-target="#group-2-workplace-population-by-industry"><span class="header-section-number">3.2.2</span> Group 2: Workplace population by industry</a></li>
  <li><a href="#group-3-corine-land-cover-classification" id="toc-group-3-corine-land-cover-classification" class="nav-link" data-scroll-target="#group-3-corine-land-cover-classification"><span class="header-section-number">3.2.3</span> Group 3: CORINE Land Cover classification</a></li>
  <li><a href="#group-4-urban-morphometrics" id="toc-group-4-urban-morphometrics" class="nav-link" data-scroll-target="#group-4-urban-morphometrics"><span class="header-section-number">3.2.4</span> Group 4: Urban morphometrics</a></li>
  <li><a href="#variable-pruning-and-final-variable-set" id="toc-variable-pruning-and-final-variable-set" class="nav-link" data-scroll-target="#variable-pruning-and-final-variable-set"><span class="header-section-number">3.2.5</span> Variable pruning and final variable set</a></li>
  </ul></li>
  <li><a href="#modelling-regression-analysis" id="toc-modelling-regression-analysis" class="nav-link" data-scroll-target="#modelling-regression-analysis"><span class="header-section-number">3.3</span> Modelling / regression analysis</a>
  <ul class="collapse">
  <li><a href="#resulting-model-specifications" id="toc-resulting-model-specifications" class="nav-link" data-scroll-target="#resulting-model-specifications"><span class="header-section-number">3.3.1</span> Resulting model specifications</a></li>
  </ul></li>
  <li><a href="#building-scenarios" id="toc-building-scenarios" class="nav-link" data-scroll-target="#building-scenarios"><span class="header-section-number">3.4</span> Building scenarios</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- TODO: Add an image showing the entire workflow. -->
<p>This page provides an outline of the methodology behind indicator modelling / calculation. For more details, please refer to the notebooks (provided in the Appendices of this book).</p>
<section id="indicator-selection" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="indicator-selection"><span class="header-section-number">3.1</span> Indicator selection</h2>
<p>We resolved to use four indicators of interest, which were shortlisted after an initial review of the available data and software, as well as the interests of the stakeholders. These are:</p>
<ul>
<li>Air quality</li>
<li>House prices</li>
<li>Job accessibility</li>
<li>Greenspace accessibility</li>
</ul>
<p>For each of these indicators, we have detailed below how they are generated. This step represents the <em>basic scenario</em>.</p>
<p>We have two different types of indicators: while air quality and house prices are derived using models which are fit to actual data, accessibilities are directly calculated using geospatial data, so are not directly modelled/predicted using explanatory variables.</p>
<section id="accessibility-calculation" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="accessibility-calculation"><span class="header-section-number">3.1.1</span> Accessibility calculation</h3>
<p>For accessibility computations, we calculate the cumulative potential accessibility to green spaces and jobs (collectively ‘opportunities’). We consider a set of origins and opportunity destination points, and the time it takes to move between them on the road network for different transport modes.</p>
<p>In order to calculate the time it takes from each origin to reach each destination, we need to have a Time Travel Matrix (TTM) between origins and destinations for different means of transport. To build this, we can generate a graph/network starting from two data sources: one for the road network, and one for public transportation schedules. Once a TTM is built between a set of origins and a set of destinations for a given mode of transport, we can run accessibility analyses on it.</p>
<ul>
<li><p><strong>Origins:</strong> For this project, we take the coordinates of the Population Weighted Centroids (PWC) of <a href="https://www.ons.gov.uk/census/2001censusandearlier/dataandproducts/outputgeography/outputareas">Output Areas</a> (OA) as the origins.</p></li>
<li><p><strong>Destinations:</strong> For each destination, we need to provide the coordinates as well as a datum for the opportunity (or ‘supply’, in our case this is the land use). For example, this could be the number of jobs available. (Other opportunities, though not considered here, could be the number of schools, health centres, or any other countable feature.)</p>
<ul>
<li><p><em>Jobs</em>: The destinations used for job accessibility are the PWCs of the working population for each Workplace Zone (WPZ) in the 2011 Census (see <a href="https://www.nomisweb.co.uk/sources/census_2011_wp">original data</a> and <a href="https://www.ons.gov.uk/methodology/geography/geographicalproducts/areaclassifications/2011workplacebasedareaclassification/classificationofworkplacezonesfortheukabouttheareaclassifications">definition</a>).</p>
<p>To obtain an opportunity measure (job counts), we make the approximation that <em>the number of workers is equal to the number of available jobs</em>. This is in order to preserve the spatial location of the jobs, which is needed in the calculation of the time travel matrix. In fact, the number of jobs in the Census is given at the OA level, but the PWC for this aggregated level can be off-centered in relation to where people work.</p>
<p>Finally, we define job accessibility as the number of jobs which are accessible by public transport and walking within 15 minutes.</p></li>
<li><p><em>Greenspace</em>: Here, we use the open data set available from <a href="https://beta.ordnancesurvey.co.uk/products/os-open-greenspace">Ordnance Survey</a> (OS). In particular, as a first approximation we consider the layer <em>“Access points”</em> from this datum. This gives the coordinates of the access points to green spaces in all of Great Britain, which we use as destinations.</p>
<p>As an opportunity measure, we count the total areas of the greenspace (layer <em>“Sites”</em>) to which these points give access to. The greenspace accessibility is then defined as the sum of the areas of greenspace sites reachable within 15 minutes.</p></li>
</ul></li>
</ul>
<p>A step-by-step description of the accessibility calculations is as follows:</p>
<p><strong>Indicator definition</strong></p>
<ol type="1">
<li>Obtain greenspace sites from OS
<ul>
<li>Filter out irrelevant categories (allotments, golf courses, bowling greens)</li>
<li>Retain entrances on the edge of the sites</li>
<li>Associate</li>
</ul>
<em>(An idea for future improvement would be to obtain “missing” areas from Corine or OSM data.)</em></li>
<li>Get the area of each site</li>
<li>Filter entrances within time threshold (15 min) of each origin (OA)</li>
<li>Consider unique values for parks (can be reached in )</li>
<li>Generate metric for each OA as the sum of reachable site size</li>
</ol>
<p><strong>Build time travel matrix (TTM)</strong></p>
<p>We can build a TTM from two data sources: the road network, and a timetable for public transport. We can obtain the first by donwloading <a href="https://wiki.openstreetmap.org/wiki/Downloading_data">OpenStreetMap (OSM)</a> data for the area of interest. Timetables for England public transport in GTFS format are available from <a href="https://itsleeds.github.io/UK2GTFS/">UK2GTFS</a>. We use GTFS data because it is more compatible with the <code>ttm</code> calculation package.</p>
<ol type="1">
<li><p>Get time table for public transport &gt; GTFS data</p></li>
<li><p>Get roads network &gt; OSM data</p></li>
<li><p>Generate network graph &gt; <code>r5</code> engine (<a href="https://github.com/conveyal/r5">Conveyal</a>) &gt; <a href="https://r5py.readthedocs.io/"><code>r5py</code> package</a></p></li>
<li><p>Generate TTM for 4 different modes &gt; ‘transit’, ‘bike’, ‘car’, ‘walking’</p>
<p><em>(An idea for future improvement would be to adjust the time threshold depending on the time of day / day of the week, as these would influence e.g.&nbsp;traffic conditions.)</em></p></li>
</ol>
<p><strong>Run accessibility analysis</strong></p>
<ol type="1">
<li>Get land use data (opportunities detailed above in <em>Destinations</em>)</li>
<li><em>Jobs</em> &gt; run <a href="https://github.com/jamaps/tracc"><code>tracc</code> package</a> on the TTM <em>for each transport mode</em>:
<ul>
<li>Compute impedance function based on a 15 minute cost (cumulative)</li>
<li>Setting up the accessibility object, i.e.&nbsp;joining the destination data to the travel time data</li>
<li>Measuring potential accessibility to jobs as the cumulative sum of opportunities at destination per origin</li>
</ul></li>
<li><em>Greenspace</em> &gt; convert the <code>tracc</code> functions to work only on reachable sites’ area, on the TTM <em>per transport mode</em>:
<ul>
<li>Compute impedance function based on a 15 minute cost (cumulative)</li>
<li>Join the destination data to the travel time data</li>
<li>Per OA (origin), select all entrances which can be reached within the threshold time, and deduplicate entrances which correspond to the same park</li>
<li>Calculate the metric as the sum of parks’ areas</li>
</ul></li>
</ol>
</section>
<section id="air-quality-index" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="air-quality-index"><span class="header-section-number">3.1.2</span> Air quality index</h3>
<p>We develop an air quality index as a composite of PM2.5, PM10, NO<sub>2</sub> and SO<sub>2</sub> values, derived from <a href="https://uk-air.defra.gov.uk/data/pcm-data">the UK AIR project by DEFRA</a>. Data are available as a 1 km grid. The composite index follows the methodology of the European Environmental Agency (EEA), reflecting the relative health risk associated with the exposure to particle intensities. Quoting from <a href="https://airindex.eea.europa.eu/Map/AQI/Viewer/">the EEA</a>:</p>
<blockquote class="blockquote">
<p>The bands are based on the relative risks associated with short-term exposure to PM2.5, O<sub>3</sub> and NO<sub>2</sub>, as defined by the World Health Organization in their Health Risks of Air Pollution in Europe (HRAPIE) project report.</p>
</blockquote>
<blockquote class="blockquote">
<p>The relative risk of exposure to PM2.5 is taken as the basis for driving the index, specifically, the increase in the risk of mortality per 10 µg/m<sup>3</sup> increase in the daily mean concentration of PM2.5.</p>
</blockquote>
<blockquote class="blockquote">
<p>Assuming linearity across the relative risk functions for O<sub>3</sub> and NO<sub>2</sub>, we calculate the concentrations of these pollutants that pose an equivalent relative risk to a 10 µg/m<sup>3</sup> increase in the daily mean of PM2.5.</p>
</blockquote>
<blockquote class="blockquote">
<p>For PM10 concentrations, a constant ratio between PM10 and PM2.5 of 1:2 is assumed, in line with the World Health Organization´s air quality guidelines for Europe.</p>
</blockquote>
<blockquote class="blockquote">
<p>For SO<sub>2</sub>, the bands reflect the limit values set under the EU Air Quality Directive.</p>
</blockquote>
<p>The relationship between PM2.5 : PM10 : NO<sub>2</sub> : O<sub>3</sub>: SO<sub>2</sub> is then equal to 1 : 2 : 4 : 5 : 10. The combined index can then be computed as <span class="math display">\[Q_{\text{air}} = \frac{\text{PM2.5}}{1} + \frac{\text{PM10}}{2} + \frac{\mathrm{NO_2}}{4} + \frac{\mathrm{O_3}}{5} + \frac{\mathrm{SO_2}}{10}\]</span></p>
<p>Except for the O<sub>3</sub>, UK AIR reports all of these values as concentrations in µg/m<sup>3</sup>. O<sub>3</sub> is reported in terms of the number of days above a threshold of 120 µg/m<sup>3</sup>, and thus cannot be used in this formula, but even EEA omits data when unavailable, so we can create the index based on the four other measurements.</p>
<p>It should also be borne in mind that UK AIR data are not direct measurements, but rather a model.</p>
<p>The data from the 1 km grid are spatially interpolated to Output Area geometries. The index itself is computed on the grid.</p>
</section>
<section id="house-price" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="house-price"><span class="header-section-number">3.1.3</span> House price</h3>
<p>An optimal way of working with house prices in the modelling exercise like ours is to use price per square metre (sqm). However, these data are not generally available at the Output Area or similar level. Luckily, we can retrieve such data from the paper <a href="https://doi.org/10.5255/UKDA-SN-854240">“<em>A new attribute-linked residential property price dataset for England and Wales 2011-2019</em>”, by Chi et al.</a>. This dataset contains individual house prices, total floor area, and a resulting price per sqm obtained from a combination of Land Registry Price Paid Data and Domestic Energy Performance Certificates.</p>
<p>We use the data from the years 2018–2019, and compute the mean price per sqm for each output area. Given the data are not fully up-to-date, the results of our modelling are presented as a percent increase or decrease compared to the baseline value rather than in absolute terms.</p>
</section>
</section>
<section id="explanatory-variables" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="explanatory-variables"><span class="header-section-number">3.2</span> Explanatory variables</h2>
<p>We curated a set of <em>explanatory variables</em>, which describe the urban environment and can be changed in order to model the different scenarios. These variables are chosen to have predictive power for the four indicators, and can be categorised into several groups according to their source.</p>
<section id="group-1-ons-population-estimates" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="group-1-ons-population-estimates"><span class="header-section-number">3.2.1</span> Group 1: ONS population estimates</h3>
<p>The first group consists of only one variable, namely, population estimates. We use the population estimates by the Office for National Statistics (ONS) at the OA level for mid-2020. The other data used in the project generally reflect the period between 2018 and 2020, so this was chosen in order to describe the compatible point in time. The dataset (titled ‘SAPE23DT10d’) is retrieved from the <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/censusoutputareaestimatesinthenortheastregionofengland">ONS website</a>. Since it is already reported at the Output Area level, it does not need to be processed further.</p>
</section>
<section id="group-2-workplace-population-by-industry" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="group-2-workplace-population-by-industry"><span class="header-section-number">3.2.2</span> Group 2: Workplace population by industry</h3>
<p>The workplace population is obtained from Census 2011 data, and is reported on Workplace Zone geometries. We use preprocessed data from the Urban Grammar project which aggregated industries into the following groups:</p>
<ol type="1">
<li><code>A, B, D, E. Agriculture, energy and water</code></li>
<li><code>C. Manufacturing</code></li>
<li><code>F. Construction</code></li>
<li><code>G, I. Distribution, hotels and restaurants</code></li>
<li><code>H, J. Transport and communication</code></li>
<li><code>K, L, M, N. Financial, real estate, professional and administrative activities</code></li>
<li><code>O, P, Q. Public administration, education and health</code></li>
<li><code>R, S, T, U. Other</code></li>
</ol>
<p>The data are then interpolated from Workplace Zones to Output Areas, giving us another 8 variables.</p>
</section>
<section id="group-3-corine-land-cover-classification" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="group-3-corine-land-cover-classification"><span class="header-section-number">3.2.3</span> Group 3: CORINE Land Cover classification</h3>
<p>We use CORINE Land Cover classification data for 2018, which are provided as polygons of contiguous areas belonging to the same class. We use the data extracted for Great Britain within the Urban Grammar project, and interpolate the data to Output Areas, which gives us the proportion of each OA covered by each class. We further filter out fully or nearly invariant classes and use only:</p>
<ol type="1">
<li><code>Discontinuous urban fabric</code></li>
<li><code>Continuous urban fabric</code></li>
<li><code>Non-irrigated arable land</code></li>
<li><code>Industrial or commercial units</code></li>
<li><code>Green urban areas</code></li>
<li><code>Pastures</code></li>
<li><code>Sport and leisure facilities</code></li>
</ol>
<p>leading to 7 more variables.</p>
</section>
<section id="group-4-urban-morphometrics" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="group-4-urban-morphometrics"><span class="header-section-number">3.2.4</span> Group 4: Urban morphometrics</h3>
<p>Urban morphometrics offers a way of describing the physical built environment (buildings, streets) in a set of quantitative measurements which capture different aspects of morphological elements. We directly use the set measured within the Urban Grammar project, which are presented as <em>individual</em> characters (prior contextualisation), and interpolate their values from the original geometry (enclosed tessellation cells) to Output Areas. This way, we obtain a contextual version using the project-specific aggregation to OA. This gives us 59 morphometric variables.</p>
</section>
<section id="variable-pruning-and-final-variable-set" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="variable-pruning-and-final-variable-set"><span class="header-section-number">3.2.5</span> Variable pruning and final variable set</h3>
<p>In total, from these four groups, we have 75 explanatory variables. Given that some of these are collected for different purposes than modelling, and with different geographical extents in mind, it may happen that some of the variables are correlated within our limited area of interest (Tyne and Wear). This may negatively affect the performance of the predictive models, and it is better to minimise the number of such pairs. We, therefore, measure both the Pearson and Spearman correlation indices between all pairs of explanatory variables. For each pair of variables where both correlation indices have an absolute value larger than 0.8, we retain only one, ideally the one that is more interpretable.</p>
<p>This procedure resulted in 16 of the morphometric variables being removed, leaving us with 59 explanatory variables in total:</p>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 82%">
</colgroup>
<thead>
<tr class="header">
<th>Group</th>
<th>#</th>
<th>Variable name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Population</td>
<td>1</td>
<td>population estimate</td>
</tr>
<tr class="even">
<td>Workplace</td>
<td>2</td>
<td>A, B, D, E. Agriculture, energy and water</td>
</tr>
<tr class="odd">
<td></td>
<td>3</td>
<td>C. Manufacturing</td>
</tr>
<tr class="even">
<td></td>
<td>4</td>
<td>F. Construction</td>
</tr>
<tr class="odd">
<td></td>
<td>5</td>
<td>G, I. Distribution, hotels and restaurants</td>
</tr>
<tr class="even">
<td></td>
<td>6</td>
<td>H, J. Transport and communication</td>
</tr>
<tr class="odd">
<td></td>
<td>7</td>
<td>K, L, M, N. Financial, real estate, professional and administrative activities</td>
</tr>
<tr class="even">
<td></td>
<td>8</td>
<td>O, P, Q. Public administration, education and health</td>
</tr>
<tr class="odd">
<td></td>
<td>9</td>
<td>R, S, T, U. Other</td>
</tr>
<tr class="even">
<td>Corine</td>
<td>10</td>
<td>Land cover [Discontinuous urban fabric]</td>
</tr>
<tr class="odd">
<td></td>
<td>11</td>
<td>Land cover [Continuous urban fabric]</td>
</tr>
<tr class="even">
<td></td>
<td>12</td>
<td>Land cover [Non-irrigated arable land]</td>
</tr>
<tr class="odd">
<td></td>
<td>13</td>
<td>Land cover [Industrial or commercial units]</td>
</tr>
<tr class="even">
<td></td>
<td>14</td>
<td>Land cover [Green urban areas]</td>
</tr>
<tr class="odd">
<td></td>
<td>15</td>
<td>Land cover [Pastures]</td>
</tr>
<tr class="even">
<td></td>
<td>16</td>
<td>Land cover [Sport and leisure facilities]</td>
</tr>
<tr class="odd">
<td>Morphometric</td>
<td>17</td>
<td>area of building</td>
</tr>
<tr class="even">
<td></td>
<td>18</td>
<td>courtyard area of building</td>
</tr>
<tr class="odd">
<td></td>
<td>19</td>
<td>circular compactness of building</td>
</tr>
<tr class="even">
<td></td>
<td>20</td>
<td>corners of building</td>
</tr>
<tr class="odd">
<td></td>
<td>21</td>
<td>squareness of building</td>
</tr>
<tr class="even">
<td></td>
<td>22</td>
<td>equivalent rectangular index of building</td>
</tr>
<tr class="odd">
<td></td>
<td>23</td>
<td>centroid - corner mean distance of building</td>
</tr>
<tr class="even">
<td></td>
<td>24</td>
<td>centroid - corner distance deviation of building</td>
</tr>
<tr class="odd">
<td></td>
<td>25</td>
<td>orientation of building</td>
</tr>
<tr class="even">
<td></td>
<td>26</td>
<td>area of ETC</td>
</tr>
<tr class="odd">
<td></td>
<td>27</td>
<td>circular compactness of ETC</td>
</tr>
<tr class="even">
<td></td>
<td>28</td>
<td>equivalent rectangular index of ETC</td>
</tr>
<tr class="odd">
<td></td>
<td>29</td>
<td>covered area ratio of ETC</td>
</tr>
<tr class="even">
<td></td>
<td>30</td>
<td>cell alignment of building</td>
</tr>
<tr class="odd">
<td></td>
<td>31</td>
<td>alignment of neighbouring buildings</td>
</tr>
<tr class="even">
<td></td>
<td>32</td>
<td>mean distance between neighbouring buildings</td>
</tr>
<tr class="odd">
<td></td>
<td>33</td>
<td>perimeter-weighted neighbours of ETC</td>
</tr>
<tr class="even">
<td></td>
<td>34</td>
<td>mean inter-building distance</td>
</tr>
<tr class="odd">
<td></td>
<td>35</td>
<td>width of street profile</td>
</tr>
<tr class="even">
<td></td>
<td>36</td>
<td>width deviation of street profile</td>
</tr>
<tr class="odd">
<td></td>
<td>37</td>
<td>openness of street profile</td>
</tr>
<tr class="even">
<td></td>
<td>38</td>
<td>length of street segment</td>
</tr>
<tr class="odd">
<td></td>
<td>39</td>
<td>linearity of street segment</td>
</tr>
<tr class="even">
<td></td>
<td>40</td>
<td>mean segment length within 3 steps</td>
</tr>
<tr class="odd">
<td></td>
<td>41</td>
<td>node degree of junction</td>
</tr>
<tr class="even">
<td></td>
<td>42</td>
<td>local proportion of 3-way intersections of street network</td>
</tr>
<tr class="odd">
<td></td>
<td>43</td>
<td>local proportion of 4-way intersections of street network</td>
</tr>
<tr class="even">
<td></td>
<td>44</td>
<td>local proportion of cul-de-sacs of street network</td>
</tr>
<tr class="odd">
<td></td>
<td>45</td>
<td>local closeness of street network</td>
</tr>
<tr class="even">
<td></td>
<td>46</td>
<td>local cul-de-sac length of street network</td>
</tr>
<tr class="odd">
<td></td>
<td>47</td>
<td>square clustering of street network</td>
</tr>
<tr class="even">
<td></td>
<td>48</td>
<td>local degree weighted node density of street network</td>
</tr>
<tr class="odd">
<td></td>
<td>49</td>
<td>street alignment of building</td>
</tr>
<tr class="even">
<td></td>
<td>50</td>
<td>area covered by edge-attached ETCs</td>
</tr>
<tr class="odd">
<td></td>
<td>51</td>
<td>buildings per meter of street segment</td>
</tr>
<tr class="even">
<td></td>
<td>52</td>
<td>reached ETCs by neighbouring segments</td>
</tr>
<tr class="odd">
<td></td>
<td>53</td>
<td>reached ETCs by tessellation contiguity</td>
</tr>
<tr class="even">
<td></td>
<td>54</td>
<td>area of enclosure</td>
</tr>
<tr class="odd">
<td></td>
<td>55</td>
<td>circular compactness of enclosure</td>
</tr>
<tr class="even">
<td></td>
<td>56</td>
<td>equivalent rectangular index of enclosure</td>
</tr>
<tr class="odd">
<td></td>
<td>57</td>
<td>orientation of enclosure</td>
</tr>
<tr class="even">
<td></td>
<td>58</td>
<td>perimeter-weighted neighbours of enclosure</td>
</tr>
<tr class="odd">
<td></td>
<td>59</td>
<td>area-weighted ETCs of enclosure</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="modelling-regression-analysis" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="modelling-regression-analysis"><span class="header-section-number">3.3</span> Modelling / regression analysis</h2>
<p>The accessibility indicators result from a deterministic model based on a fixed travel-time matrix. Hence, any new scenario being modelled can re-use it by changing only the raw values at the destinations. On the other hand, we need to develop predictive models to be able to see the changes in air quality and house prices.</p>
<p>Both of these models use the same classifier, a histogram-based gradient boosting regression tree as <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingRegressor.html">implemented in the <code>scikit-learn</code> Python package</a>, and the set of 59 explanatory variables listed above. To ensure we are able to properly capture the spatial nature of the indicators, we add another 59 features which are a spatial lag of the original set. The spatial lag is measured as a mean value of the variable within a set neighbourhood, the definition of which is empirically determined. We test the neighbourhoods based on contiguity (from order of contiguity 1 to 5 inclusive of lower-order neighbors), Euclidean distance (500 m, 1000 m, 2000 m), and their unions. Each option is then included as part of the grid search aimed at the selection of the best model parameters and the best definition of the spatial lag in relation to the model performance metrics (the coefficient of determination <em>R</em><sup>2</sup>, mean squared error, and mean absolute error). Other model parameters which we also assess are the learning rate, the maximum number of iterations, and the maximum number of bins. For more details, see the implementation in the <a href="../code/02_models/04b_air_quality_model_search.html">Air Quality notebook</a> and the <a href="../code/02_models/05b_house_price_model_search.html">House Price notebook</a>.</p>
<p>Furthermore, we have experimented with the geographical extent of the training data. While the original models were based only on the data from the study area (Tyne and Wear), we have tested models trained on other geographical subsets:</p>
<ul>
<li>the whole of England</li>
<li>the whole of England, but excluding Greater London, which is known to be an outlier that may not help in predictive quality within Tyne and Wear</li>
<li>Tyne and Wear plus all OAs belonging to “Urbanity” classes from the rest of England</li>
</ul>
<p>The aim of this is to add additional robustness to the model by training on a wider set of data.</p>
<section id="resulting-model-specifications" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="resulting-model-specifications"><span class="header-section-number">3.3.1</span> Resulting model specifications</h3>
<p>The resulting models, selected based on their performance, are based on the following specifications:</p>
<p><strong>Air Quality</strong></p>
<ul>
<li>Spatial extent: Tyne and Wear plus all OAs belonging to “Urbanity” classes from the rest of England</li>
<li>Spatial lag: A union of 5 orders of Queen contiguity and 2000 m distance band</li>
<li>Model parameters: <code>learning_rate=0.2</code>, <code>max_bins=64</code>, <code>max_iter=1000</code></li>
</ul>
<p>The model performance (<em>R</em><sup>2</sup>) is ~0.8.</p>
<p><strong>House Price</strong></p>
<ul>
<li>Spatial extent: England excluding Greater London</li>
<li>Spatial lag: 5 orders of Queen contiguity</li>
<li>Model parameters: <code>learning_rate=0.1</code>, <code>max_bins=128</code>, <code>max_iter=1000</code></li>
</ul>
<p>The model performance (<em>R</em><sup>2</sup>) is ~0.5.</p>
</section>
</section>
<section id="building-scenarios" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="building-scenarios"><span class="header-section-number">3.4</span> Building scenarios</h2>
<p>Scenarios are constructed by changing four <strong>macro variables</strong>, which together drive a sampling mechanism which derives the 59 variables used in the modelling. The four variables are:</p>
<ol type="1">
<li><em>Level of urbanity</em>, which is a proxy for a signature type of spatial signatures as defined in the Urban Grammar project;</li>
<li><em>Use</em> of buildings, referring to the ratio of residential and commercial or industrial use;</li>
<li><em>Job types</em>, which determines whether jobs in each Output Area are more white-collar or blue-collar; and</li>
<li><em>Greenspace</em>, reflecting the amount of formal greenspace (i.e.&nbsp;parks).</li>
</ol>
<p>Scenarios are modelled by specifying the macro variables on Output Areas where the change takes place. Any of the four variables can be specified in combination with any other. The algorithm then samples the data from either the baseline (capturing the existing state) or from the known distribution of values per signature type based on the country-wide data.</p>
<p>The first step in the sampling procedure is the selection of a signature type. If it is not changed, subsequent steps modify the baseline. Otherwise, we sample the values for a set signature type reflecting its common characteristics as observed across Great Britain. For example, if we specify the ‘local urbanity’ signature type for an Output Area which previously had ‘dense urban neighbourhoods’ assigned, we look at how ‘local urbanity’ usually looks like and sample all the required values from a narrow normal distribution centred on the median of the nationwide distribution. Further macro variables are adjusting these values. The <em>use</em> macro variable will change the variables of population and workplace population, <em>job types</em> will change the distribution of jobs between the job type categories, and <em>greenspace</em> will allocate new parks onto an Output Area (adjusting other values such as population accordingly).</p>
<p>Development of each scenario is then comprised of a few simple steps:</p>
<ol type="1">
<li>Select Output Areas that are supposed to change</li>
<li>Assessing the target level of urbanity for each Output Area</li>
<li>Assessing other macro variables for each Output Area</li>
<li>From these, sample the values to be used as input for the model</li>
<li>Run the models to assess the effect of tested changes</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../book/data_sources.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data sources</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../book/scenarios.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scenarios</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>