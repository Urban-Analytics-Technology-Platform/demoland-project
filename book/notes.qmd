# Notes
<!-- Note that for images the relative path doesn't work since moved the book to separate repo and automated quarto publishing -->
<!-- links like "![](./../images/tynewear_lads_msoas.png)" nor "![](images/tynewear_lads_msoas.png)"" (as done before) wouldn't work-->
<!-- followed the suggestions from here  https://stackoverflow.com/questions/51002481/images-not-loading-when-deploying-to-github-pages-->
<!-- eventually the actual path + "?raw=true" works, though try to get back to a relative path when possible -->

This page is constantly updated on an (almost) daily base, meaning that the order is not dictated by a specific structure, just temporary adding up ideas and development of the project.

NB: in reverse order, that is more recent stuff is at the top of the document.

## February

### Open issues/questions on indicators building

**Accessibility**

accessibility measures:

- routing engine: *5r*
     - in python:
         - together with `tracc` or `pysal/access`
         - use `conveyal` with `mongoDB` <mark>(not tried yet)</mark>
     - in R: wrapped within *r5r* <mark>(not tried yet)</mark>
- ttm generation:
     - we only consider origins within the county, what about extra zonal areas?
     - can generate one single table with multimodal trip
     - how does it work with scenarios generation - especially for OSM
- GTFS data:
     - good source for UK or do we need to generate it ourselves from
     - can we change the file, in case we want add a route / stop?
- measuring acc to jobs:
     - can we find more detailed data of _where_ people work?
     - and of where people live?
- 15 min neighborhoods
     - it doesn't seem relevant until we do not have where people live, IE what we'd do is only measuring 15 min between centroids


**Work in progress**

Checking the possibility to view and edit GTFS data with `[gtfs_kit](https://gitlab.com/mrcagney/gtfs_kit)` in Python.<br/>
All the trials are in `python/gtfs_kit_trials.ipynb`.<br/>
Note: created env_gtfs-kit.yml environment to test the package.

working with the files in `raw/GTFS`:

 - `itm_all_gtfs.zip`:
     - GTFS file downloaded from https://data.bus-data.dft.gov.uk/timetable/download/gtfs-file/all/
     - this file was accessed though the website https://www.transit.land/feeds/f-bus~dft~gov~uk
     - It contains all the UK buses only? <mark>**CHECKING**</mark>
 - `NE.zip`:
     - GTFS generated and downloaded from UK2GTFS https://github.com/ITSLeeds/UK2GTFS, see _releases_
     - this file has no shape.txt but it’s for North East England

Have done some trials in Qgis to view the routes (starting from the file shape.txt), we want to understand if only buses are in this GTFS data or also for example the light rail line (Yellow, owned and managed by [Nexus](https://www.nexus.org.uk/metro)) is included.

It might be a disadvantage to use the whole UK data, but it might be more complete than the local one (NE) generated in UK2GTFS.

We would like also to be able to edit the GTFS data, adding a line/stop.






## January

January starts basically as a continuation of the work started in December.

_Warming up_<br/>
Image created in Qgis showing median house prices (year ending March 2022) and green spaces in Tyne and Wear county (current case study):
![](https://github.com/ciupava/LandUseDemonstrator/blob/main/images/tynewear_houseprices2022_greenspace_lsoa.png?raw=true)
*Note:*

- houseprices [data](#house-prices-indicator) are associated to the LSOA boundaries shp via the python code in [`data_prep.ipynb`](./../python/data_prep.ipynb)
- green spaces are from the OS open data base [see description here](#variables-creation)

### Accessibility accessibility accessibility

> Accessibility is understood as the ease with which a person can reach places and opportunities from a given location and it results from the interaction between the transport system, land-use patterns, and the constraints of individuals <br/> (Pereira et al. 2019, _Distributional effects of transport policies on inequalities in access to opportunities in Rio de Janeiro_, Journal of Transport and Land Use 12(1): 741-764)

Let's start from *green spaces* (easier?) to create methodology, then pass on to *jobs*...

- resolution (LSOA...?)
- find relation to land use
- generate indicators: 
     - relevant variables
     - relevant scenarios

---

**IDEAS in random order**

- [ ] accessibility definition??
- [ ] Identify the shortest path between two locations using the OSM transport network:
     - [ ] [routino](https://www.routino.org/) application for finding a route between two points using OSM
     - [ ] [valhalla](https://valhalla.github.io/valhalla/) open source routing engine and accompanying libraries for use with OSM
     - [X] [OpenTripPlanner](https://wiki.openstreetmap.org/wiki/OpenTripPlanner) open-source multimodal trip planning software system
     - [ ] Plan4better [Geo Open Accessibility](https://plan4better.de/en/) GOAT tool
     - [ ] [OSMnx](https://osmnx.readthedocs.io/en/stable/) Python package
     - [ ] build from OSM and implementing Dijkstra myself (??? @Dustin suggestion)
     - [X] [R5 - Conveyal](https://github.com/conveyal/r5):
          - in R: [r5r](https://ipeagit.github.io/r5r/)
          - in Python: <mark>[r5py](https://r5py.readthedocs.io/en/stable/index.html)</mark>
- [ ] ... check Propensity to Cycle Tool by Robin? [PTC]
- [ ] define the paths we want to see https://en.wikipedia.org/wiki/Shortest_path_problem#Algorithms
     - from where to where?
     - how to define people's home... ~~centroids~~ buildings??

---

2 ways of seeing accessibility:

- between "areas" (IE "from this LSOA I can access N schools/jobs/... located in other LSOAS")<br/>
    calculated using origin/destination matrix for centroids (pop weighted likely) and cumulative sum of opportunities
- from the amenity (school/job/hospital...) <br/>
    generate a N-min "isochrone" (depending on mode) and see how it overlaps with population distribution (at LSOA level? the more detailed the merrier)

apparently the distinction is between passive and active accessibility [see](https://github.com/jamaps/tracc)

---

*Note* <br/>
When you have available the 2 datasets:

1. `land_use_data` - file with columns like `population`, `jobs`, `school` per LSOA (or whichever geography unit)
2. `travel_matrix` - origin destination matrix with travel cost column (can use time rather than distance, as a cost proxy) per LSOAs (`from_id`, `to_id`, `travel_time`)

you can run and play around with the package from [Rafa Pereira](https://github.com/ipeaGIT/accessibility), see if it comes useful

_**even better:**_<br/>
from the above (written in `R`), reference to Python stuff here:
<blockquote>
- [tracc](https://github.com/jamaps/tracc): Transport accessibility measures in Python
- [access](https://access.readthedocs.io/en/latest/): Spatial Accessfor PySAL
     - [aceso](https://github.com/tetraptych/aceso): a lightweight Python package for measuring spatial accessibility
</blockquote>

... see application and comments directly in [accessib.ipynb](./../python/accessib.ipynb)<br/>

In order to run these functions we need to create/have the following input files:

 - transit time data (origin-destination matrix with time) per area
 - supply:

     - a. _job counts per area_ can download data at LSOA level (one file per LAD, or full county) from [Nomis BRES](https://www.nomisweb.co.uk/sources/bres)
     - b. _other type of opportunity_ (ex: n of groceries, n of schools, etc... extension of greenspace? <mark>**n of access points?**</mark>)<br/><br/> as a proxy for future complicated stuff and to try something for now, let's generate the number of access points (to greenspaces) per LSOA... <br/>what would be the fastest way:

          - QGIS analysis (sure a function exists for this, but this solution is valid only temporarily, better the next one)
          - in Python with Geopandas (or similar stuff) I assume it's doable

A good explanation of the process is in the [r5py documentation](https://r5py.readthedocs.io/en/stable/notebooks/basic-usage.html#data-requirements)


---

**Trials**

Different trials for accessibility calculation are accessible as notebook files within the [python folder](./../python/), generally named as `accessib_****_.ipynb`

**1. OTP**

Calculations for OTP in the script `[accessib_OTP.ipynb](./../python/accessib_OTP.ipynb)`

Started by the tutorial at [https://github.com/marcusyoung/otp-tutorial](https://github.com/marcusyoung/otp-tutorial)

> Young, M. (2021). OpenTripPlanner - creating and querying your own multi-modal route planner.

![](https://github.com/ciupava/LandUseDemonstrator/blob/main/images/tynewear_isochrones_withOTP.png?raw=true)*Examples of 15-90 minisochrones from (54.96835, -1.60778) generated using OTP for walk/transit mode, at 9am on 01-19-2-23)*

- [X] time travel matrix $\rightarrow$ using OTP OpenTripPlanner with M Young instructions
     - [X] find GTFS data
     - [X] download OSM data
     - [X] build graph.obj
- [X] supply data (opportunities / land use / ...)
- [X] run `tracc` for calculating accessibility to jobs... see [basic_accessibility_example_TRACC.ipynb](./../python/basic_accessibility_example_TRACC.ipynb)
- [X] run also for green spaces, as in "minimum travel time to reach n destinations" (see above link)

**Feedback**<br/>
The above procedure makes it unclear to understand the results PLUS editing the parameters by own requirements (in particular in creating the TTM), **so** trying to re-do the same <mark>**using r5py**</mark>

**2. r5py + tracc**

- [X] time travel matrix   --> more editable?? _shorter to generate, no nedd of a graph building_
     - [X] find GTFS data
     - [X] download OSM data
     - [X] build ~~graph.obj?~~ network
- [X] supply data (opportunities / land use / ...)
- [X] calculating accessibility to jobs  _using `tracc`_
- [X] run also for green spaces, as in "minimum travel time to reach n destinations" _using `tracc`_

Note that the accessibility calculation is not supported in the `r5py` (see [here](https://r5py.readthedocs.io/en/stable/notebooks/basic-usage.html#introduction))

> At the time of this writing, only the computation of travel time matrices has been fully implemented. Over time, r5py will be expanded to incorporate other functionalities from R5.

but you can run this `r5` functionality (and everything that _Conveyal_ does, IE "Conveyal Analysis") using `MongoDB` locally:<br/>
[github page](https://github.com/conveyal/r5#configuration)

**-STILL NEED TO CHECK THIS OPTION-**

---

<mark>**TO_DO:**</mark>  (once run the above stuff, first trial with jobs accessibilty) <br/>
**generalise** the procedure above in order to create indicators for accessibility:

 - input variables format (table fields, etc)
 - understand how to edit parameters of time travel matrix and generate more of them
 - understand how travel time matrix work, as atm it seems to only generate transit mode matrix
 - scenarios?

---

## December

<mark>Hands on code finally?</mark>

1. Let's start from the indicator of `House prices`, as it is the only one indicator we have atm that is actual values data, not deterministically defined (see [table here](data_sources.qmd#comprehensive-tables)).<br/>
2. Also `greenspace` is a possible candidate to start the analysis, for determining a method for <mark>accessibility calculation</mark>. In this case consider [Valhalla](https://valhalla.readthedocs.io/en/latest/valhalla-intro/).

![](https://github.com/ciupava/LandUseDemonstrator/blob/main/images/tynewear_lads_msoas.png?raw=true)*The 5 LADs in Tine and Wear (labelled by `LAD20NM` and `LAD20CD`), highlighted in gray the major urban areas, bordered in blue the 145 MSOAs*

---

Putting in doubt the use of LUR for what we want to do <mark>as we are gonna have aggregated outputs</mark>
<blockquote>
This regression-based approach estimates the ambient pollutant concentrations at un-sampled points of interest by considering the relationship between ambient concentrations and several predictor variables selected from the surrounding environment
</blockquote>
<blockquote>A raster graphic image of the area is generated and intersected with area-level population data to formulate the exposure distribution.</blockquote>

Example of a raster as output of a LUR analysis:

![](https://github.com/ciupava/LandUseDemonstrator/blob/main/images/rlur_example.png?raw=true)

**QUESTION:** WHY do we want aggregated (MSOAs) outputs? <br/>*I think it's because we want to be able to compare among scenarios*
<br/>+ (quoting Dani) *because SPC data is at MSOAs scale*

---

Inputs from call with Federico (14 Dec):

  - [jobs posting tracker](https://github.com/hiring-lab/job_postings_tracker) (ONS ???)
      - from Indeed Hiring Lab (employment website for job listings)
      - In the United Kingdom, they provide:
         - `regional_postings_gb.csv` This file contains the % change in seasonally-adjusted postings since February 1, 2020 for total job postings in each region in the UK.
         - `city_postings_gb.csv` This file contains the % change in seasonally-adjusted postings since February 1, 2020 for total job postings in each city in the UK.
  - BRES (Business Registry and Employment Survey) [data](https://www.nomisweb.co.uk/sources/bres)
      - An employer survey of the number of jobs held, broken down by industry
      - estimates at detailed geographical and industrial levels (from country down to LSOA)

---

**Exploratory phase**
The idea is to plot/visualise/put together a few pieces of information and see how they interact with each other, get ideas on what to do with them.

Steps:

- [X] understanding Python VS excel (for house prices data)
- [X] understanding Python VS shp (for greenspace data + admin boundaries)
- [ ] plot house prices VS greenspace locations
- [ ] understanding json (valhalla) VS maps/python etc... know nothing


### House prices indicator

**Data processing workflow**

- See available datasets for House Price Statistics for Small Areas (HPSSAs) from [here: houseprices_available-data_HPSSA.xlsx](https://github.com/ciupava/LandUseDemonstrator/tree/main/data)
- The [tables](https://www.ons.gov.uk/peoplepopulationandcommunity/housing/bulletins/housepricestatisticsforsmallareas/yearendingmarch2022) come in _.xls_ format
- choose either MSOA or LSOA level:
     - **HPSSA Dataset 2** - Median price paid by MSOA.xls [file](https://www.ons.gov.uk/peoplepopulationandcommunity/housing/datasets/hpssadataset2medianhousepricebymsoaquarterlyrollingyear) (September 2022 version);<br/>
     note that this dataset contains also breakdown by house type (detached, semidetached, terraced) and by newly/existing dwellings
     - **HPSSA Dataset 46** - Median house prices by LSOA.xls [file](https://www.ons.gov.uk/peoplepopulationandcommunity/housing/datasets/medianpricepaidbylowerlayersuperoutputareahpssadataset46)
- need to estrapolate just the tab with the relevant info ... $\rightarrow$ <mark>automate this??</mark> <br/>
"table 1a (all house types)"" = _Median price paid by MSOA, England and Wales, year ending Dec 1995 to year ending Mar 2022_
- filtering just the relevant grographies for Tyne and Wear county: $\rightarrow$  <mark>automate this??</mark>
     - MSOAs: [list in MSOAs_Tyne-Wear.txt](https://github.com/ciupava/LandUseDemonstrator/tree/main/data)<br/>
     `MSOA20CD` = `MSOA code`<br/>
     `MSOA20NM` = `MSOA name`<br/>
     - LSOAs: [list in TyneWear_LADs_list.csv](https://github.com/ciupava/LandUseDemonstrator/tree/main/data) filter by Local authority:<br/>
       code `LAD20CD` = `Local authority code`<br/>
       name `LAD20NM` = `Local authority name`
- choose time ... data published quarterly (4 times a year) with all editions back to 1995
- 

### Accessibility (... Greenspaces)

- remove "private" spaces from the analysis (IE golf clubs)?
- check "overlapping" features like pitches/leisure centres/etc within parks


- routing $\rightarrow$ Valhalla [isochrones](https://valhalla.readthedocs.io/en/latest/api/isochrone/api-reference/)
- census data
- relevant layers: public venues (schools, hospitals), green/blue spaces, 



## Agenda - November, 29 [Tue] - In office

- [ ] review of the project (objective, idea...)
- [ ] discussing the data
  - see table in [data page](data_sources.qmd)
  - see sources below:
     - accessibility (how to calculate, sources)
     - GHG emission (resolution)
     - house prices (the least concern?)
- [ ] discussing methodology
  - 2 processes to generate indicators:
     - LUR
     - <mark>_____________</mark> (accessibility)
  - output
- [ ] name

## November

Need to fine-tune things after last talk with Dani (end of October).

Instead of trying to reproduce [carbon.place results](#did-someone-already-do-this), we want to produce a <mark>**Land Use regression model**</mark> $\rightarrow$ **[LUR](#some-literature-on-lur)**

**MAJOR UPDATE** - We can't use a regression model for indicators such as _accessibility_, where the dataset is derived/generated by us and not coming from "actual" measurement (like is the case for ~~GHG emissions or~~ house prices, for instance). <br/>In this case we will need to find another procedure to generate a modelisation. We will then have <mark>**2 different procedures**</mark> to generate the indicators, depending on the type of indicator.<br/>
Within these two types, we aim at generating anyways a <mark>comprehensive methodology</mark> accross indicators to assess/analyse the different scenarios.<br/>A certain scenario can in fact affect different indicators, for example removing a green area to add a working compound can impact positively jobs accessibility, lowering greenspace accessibility.

---

### Project name

A <mark>**good name**</mark> for the project? (acronym*)

what does "demonstrator" stand for, why should we stick to that term?

- [ ] **L(O)UD** = Land (:egg:) Use Demonstrator :mega:
- [X] **demoland** &#x1F3D9;
- [ ] &#x1F95A; and &#x1F425; ... &#x1F373;
    - **LAID** = LAnd Use Indicators Demonstrator &#x1FAB9;
    - **NEST** (?) &#x1FABA;
- [ ] **LOUSE** = Land (o) USe Explanator <br/>  &#x1FAB2; ('louse' is singular for lice)
- [ ] **DODO** &#x1F9A4; ... just because it's a nice name

### Variables creation

We are searching data for:

- the indicators
- the variables (land use features) to predict the indicators

In a first phase we are concentrating on 4 of the indicators (the numbering refers to the Intro list [here](intro.qmd#indicators-building)):<br/>
_1.a/b_. **Pollution/emissions**<br/>
_1.c_. **Green space accessibility**<br/>
_2.b_. **Jobs accessibility**<br/>
_2.c_. **House prices**<br/>
Below, some notes for each indicator on the data searching process


--- 

_1.a/b_. **Pollution/emissions**

**Indicator:** *GHG emissions*

**Predictive variables:** *no. of trips, distance travelled, mode of transport*


- data for GHG emissions (total, IE comprehensive of mobility, housing, etc) is available from gov.uk [only at LAD level](#data-availability)

- [not relevant] _estimated_ Per Capita Consumption-Based Greenhouse Gas Emissions for UK Lower and Middle Layer Super Output Areas, 2016. [Data Collection](https://reshare.ukdataservice.ac.uk/854888/)<br/>Kilian, Lena and Owen, Anne and Newing, Andy and Ivanova, Diana (2021).<br/>UK Data Service. 10.5255/UKDA-SN-854888

---

_1.c_. **Green space accessibility**

**Indicator:** *Green space accessibility*

**Predictive variables:** *number of access points, areal extention of greenspaces, distance from greenspace (access point)*

Definition:

<blockquote> proportion of an urban population living within a certain distance from a green space boundary</blockquote><br/>
[Van Den Bosch et al., 2016](https://pubmed.ncbi.nlm.nih.gov/26573907/)

- UGS = Urban Green Space

- see [Issue](https://github.com/ciupava/LandUseDemonstrator/issues/5) on GitHub for relevant literature on indicators, definitions, methodology to generate UGS maps

- accessibility is not actual data (like emissions for instance) but it's itself calculated as an index, so what is the meaning in modeling it?

- how we calculate the distance to the nearest green space... or the entrance gate (tricky)

- **EEA Urban Atlas** for UGS data (landcover map) [data available here](https://www.eea.europa.eu/data-and-maps/data/copernicus-land-monitoring-service-urban-atlas) <br/>
Download per each metro areas [here](https://land.copernicus.eu/local/urban-atlas/urban-atlas-2018?tab=download)<br/>
Method described in [WHO Europe 2016 report](https://www.euro.who.int/__data/assets/pdf_file/0005/321971/Urban-green-spaces-and-health-review-evidence.pdf)
<blockquote>
**European Urban Atlas Class 1.4.1 (vector data code 14100):<br/>Green Urban Areas** (European Commission, 2011)<br/>
Minimum mapping resolution 0.25 ha, Minimum width: 10 m<br/>
*Included:*<br/>
• Public green areas for predominantly recreational use such as gardens, zoos, parks, castle parks.<br/>
• Suburban natural areas that have become and are managed as urban parks.<br/>
• Forests or green areas extending from the surroundings into urban areas are mapped as green urban areas when at least two sides are bordered by urban areas and structures, and traces of recreational use are visible.<br/>
*Not included:*<br/>
• Private gardens within housing areas<br/>
• Cemeteries<br/>
• Buildings within parks, such as castles or museums<br/>
• Patches of natural vegetation or agricultural areas enclosed by built‐up areas without being managed as green urban areas
</blockquote>

    Note that several green areas in Newcastle fall under the category "Pasture" (see for example Nuns Moor)
<blockquote>
    Lands that are permanently used (at least 5 years) for fodder production. Includes natural or sown herbaceous species, unimproved or lightly improved meadows and grazed or mechanically harvested meadows. Regular agriculture impact influences the natural development of natural herbaceous species composition.
</blockquote>
    and allotments fall into "Sports and leisure facilities"

![](images/WHO_method_for_UGS.png)

- <mark>**UK SOURCES**</mark><br/>
    - **Ordnance Survey** [Open greenspace map](https://osdatahub.os.uk/downloads/open/OpenGreenspace) with technical notes [here](https://www.ordnancesurvey.co.uk/business-government/tools-support/open-map-greenspace-support) <br/>
    $\rightarrow \rightarrow$ *open data!* <br/>
    Advantages:<br/>
        - more accurate
        - covers England, Scotland, Wales
        - **has access points!!**
        - need for data cleaning, as many sport facilities/playgrounds are drawn with a separate polygon within the big park they are part of (overlapping features in the shp)
        - the file includes cemeteries AND allottments
    - **Natural England** [Accessible Natural Green Space Standards in Towns and Cities: A Review and Toolkit for their Implementation (ENRR526)](http://publications.naturalengland.org.uk/publication/65021)
        - review and toolkit
    - **Public Health England** [report](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/904439/Improving_access_to_greenspace_2020_review.pdf) 
        - ... data??
    - **Fields in trust** [Green Space Index](https://www.fieldsintrust.org/green-space-index)
        - [interactive map](https://experience.arcgis.com/experience/5301c55a8189410b9428a90f05596af4)
        - they launched GSI in 2019
        - they use OS Open Greenspace Map (above) and ArcGIS
        - not available as open data
    - **[AHAH](#ahah) [Access to Healthy Assets & Hazards](https://data.cdrc.ac.uk/dataset/access-healthy-assets-hazards-ahah)** (Dani suggested) 
        
        • A multi-dimensional index developed by the CDRC for Great Britain at LSOA level, contains also access to greenspace (passive) - already calculated
        
        • ... different versions:

        VERSION 3 (2022)<br/>
        
        VERSION 2 (2017) <br/>
        
        VERSION 1 (2016)
        
        • the current version (3) only gives the 'passive' greenspace, in terms of NDVI values (from Sentinel)
        <figure>
            <img src="images/ahah_why.png"/ width="650">
            <figcaption>Screenshot from the `metadata` file (Version 3)</figcaption>
        </figure>
        <!-- ![screenshot from the `metadata` file](images/ahah_why.png) -->
        where the values range between ... and ... (that's the index)

        though, by the description the "passive" greenspace should be a measure of surface (km2):

        <figure>
            <img src="images/ahah_2017.png"/ width="650">
            <figcaption>Screenshot from the Version 2 Short Technical Report</figcaption>
        </figure>
        ... see "active" and "passive" greenspace definition below

        • the latest pubblication claims to use OSM data:<br/>
        [Daras K., Green M. A., Davies A., Barr B., Singleton A. 2019. Open data on health-related neighbourhood features in Great Britain. Scientific data 6 (1), 107. DOI: 10.1038/s41597-019-0114-6](https://www.nature.com/articles/s41597-019-0114-6)
        <blockquote>
        From all the available types of ‘green’ spaces in the **OSM data**, we selected only areas tagged as public accessible with the following area types: <mark>cemetery, common, dog park, scrub, fell, forest, garden, greenfield, golf course, grass, grassland, heath, meadow, nature reserve, orchard, park, pitch, recreation ground, village green, vineyard and wood </mark><br/>
        ...<br/>
        The green space indicator has been defined as an area measure of access to green space available to each postcode that intersect with a 900 meters buffer zone
        </blockquote>


        but, from this 2019 publication, it looks like they are using the OS dataset (and giving both active and passive access): <br/>
        [Daras, K., Green, MA., Davies, A., Singleton, A., Barr, B. 2019. Access to Healthy Assets and Hazards (AHAH) - Updated version 2017. figshare. Short Technical Report. DOI: 10.6084/m9.figshare.8295842.v1](https://figshare.com/articles/online_resource/Access_to_Healthy_Assets_and_Hazards_AHAH_-_Updated_version_2017/8295842/1)
        <blockquote>
        Open data from OS on Green spaces was used for preparing two variables related to the distance from the nearest green space (active) and the total green space areas available to each postcode in a range of a 900-meter buffer (passive) before creating LSOA level averages
        </blockquote>
        [Note on Active and Passive Green Spaces](https://data.cdrc.ac.uk/dataset/access-healthy-assets-hazards-ahah/resource/note-active-and-passive-green-spaces-v2)
        <blockquote>
        'active' is based on the distance people have to travel to their nearest greenspace access point conducive to physical activity [...]<br/>
        The measure is built up from analysis at the postcode level. Distances from each postcode centroid along road networks to the nearest greenspace access point are calculated. Postcodes are matched to LSOAs and an average is taken to get an LSOA score (mean value).<br/>

        The second greenspace indicator labelled as 'passive' is based on the proportion of greenspace within a 900 meter buffer (~15 mins walk) from where people live
        </blockquote>

        the (assumed?) first version though uses OSM (like described above):<br/>
        [Green, M. A., Daras, K., Davies, A., Barr, B. & Singleton, A. 2018. Developing an openly accessible multi-dimensional small area index of ‘Access to Healthy Assets and Hazards’ for Great Britain,](https://doi.org/10.1016/j.healthplace.2018.08.019) <br/>
        but is aware of OS, from the Appendix:
        <blockquote>
        There were few open source alternatives (or data that could be shared openly within the terms of their licences) containing similar data during the construction of the indicators and our index. <mark>Since then, the **Ordnance Survey (OS)** have released an open resource of locations of green space </mark>(OS Green Space Layer; https://getoutside.ordnancesurvey.co.uk/greenspaces/) . We are currently undertaking a full comparison of OSM and OS to explore the strengths and weaknesses of each data source with the aim of improving our green space metrics, however such an evaluation is beyond the scope of this paper. 
        </blockquote>

        • They use *Routino* open source software [https://www.routino.org](https://www.routino.org) to identify the shortest path between two locations using the OSM transport network
        <blockquote>
        measured the network distance between the population-weighted centroid of each postcode in the National Statistics Postcode Lookup (NSPL) and the coordinates of the nearest service (e.g. a population-weighted centroid of postcode for off-license)
        </blockquote>
        code [here](https://github.com/GDSL-UL/AHAH)

    - **Conclusions:**
        - not enough METADATA to be able to understand what to use (missing field names)
        - not clear which data source they use in which version (NDVI, OS, OSM?)
        - only passive accessibility available in last version

        <mark>WRITE TO THE TEAM</mark> detailed list of questions


---

_2.b_. **Jobs accessibility**

**Indicator:** *accessibility to jobs (measured/calculated)*

**Predictive variables:** *working population, n. of available jobs*

- accessibility is not actual data (like emissions for instance) but it's itself calculated as an index, so what is the meaning in modeling it?
- QUANT [map](http://quant.casa.ucl.ac.uk/map2.aspx?v=JobAccessibilityObs)
        - how is it calculated
        - how to download it ... format, etc
- [Accessibility Destination Datasets](#accessibility-data) see paragraph below

---

_2.c_. **House prices**

**Indicator:** *house price (avg / zonal effect / dimension / amenities ???)*

**Predictive variables:** *dwellings availability, services, accessibility to PT*

   - what scenario on house prices?
   - **[gov.uk data](https://www.data.gov.uk/search?q=house+price)**<br/>
   most recent source:<br/>
   [House price statistics for small areas in England and Wales: year ending March 2022](https://www.ons.gov.uk/peoplepopulationandcommunity/housing/bulletins/housepricestatisticsforsmallareas/yearendingmarch2022)
     - **Differences to other house price statistics:**
    <blockquote>
    There are two sets of official statistics for house prices. In addition to these **HPSSAs**, the Office for National Statistics (ONS) also produces the **UK House Price Index (UK HPI)**. The HPSSAs measure the number of property transactions and the price paid for properties sold in a given period, while the UK HPI measures the changing value of properties in the housing market. You can find out more about the differences and uses of these outputs in our House price statistics for small areas Quality and Methodology Information (QMI).
    </blockquote>

   - available at MSOA level:

| Dataset No.| Dataset Name| Periodicity |
|-|-|-|
HPSSA dataset 1 | Number of sales of residential properties for middle layer super output areas | Quarterly
HPSSA dataset 2 | Median price paid for middle layer super output areas | Quarterly
HPSSA dataset 3 | Mean house prices for middle layer super output areas | Quarterly
HPSSA dataset 4 | Lower quartile house prices for middle layer super output areas | Annually
HPSSA dataset 5 | Tenth percentile house prices for middle layer super output areas | Quarterly



#### Accessibility data

<mark>**UPDATE**</mark>

It seems that from 2014 the same type of data is released as [Journeytime Statistics](https://www.gov.uk/government/publications/journey-time-statistics-guidance)

with the list of tables available [here](https://www.gov.uk/government/statistical-data-sets/journey-time-statistics-data-tables-jts#user-access-to-key-services-by-journey-time-jts02)

NEED TO CHECK if they give also number of people, that seems missing in the new data format.<br/>
For example the variable:

| | | |
|-|-|-|
`All20_PT/walk` | EMPLO049 | Users within 20 minutes by PT/walk

does not appear in the new tables, though, we have the total population (`Empl_pop`) AND the percentage of population per each mode of transport + time, for example (for table 0501):<br/>


|Field|Alternate name|Description|
|-|-|-|
`100EmpPT15pct` | Emp106 | % users within 15 minutes of employment centres with 100 to 499 jobs available by PT/walk
`100EmpPT30pct` | Emp107 | % users within 30 minutes of employment centres with 100 to 499 jobs available by PT/walk
`100EmpPT45pct` | Emp108 | % users within 45 minutes of employment centres with 100 to 499 jobs available by PT/walk
`100EmpPT60pct` | Emp109 | % users within 60 minutes of employment centres with 100 to 499 jobs available by PT/walk

... from which we could infer the variable above?
<br/>

---

Some useful and valuable datasets on *accessibility* by several means of transport was (apparently?) available from DFT until 2012, in csv format.<br/>
After some strenuous research managed to find the archive for it [here](https://webarchive.nationalarchives.gov.uk/ukgwa/20131223133629mp_/https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/240307/accessibility-statistics-2012.pdf).

**Accessibility Destination Datasets**

- they measure accessibility to key services like: 
    - food stores
    - education
    - health care
    - town centres
    - employment centres
- published for England at national, regional, LAD and LSOA level. 
- have they been substited by [Journey time statistics](https://www.gov.uk/government/collections/journey-time-statistics) data?

***Note*** data at LSOA level is also available in gov.uk [in xls format](https://www.gov.uk/government/statistical-data-sets/acs05-travel-time-destination-and-origin-indicators-to-key-sites-and-services-by-lower-super-output-area-lsoa)

where also 2013 is included!

<blockquote>Excel datasets containing raw destination data for calculating Accessibility statistics. This gives the locations of the different services used within these calculations: Primary schools, Secondary Schools, Further Education, Hospitals, GPs, Town Centres, Employment Centres</blockquote>

these makes up to 8 tables of accessibility:

![](images/accessibility_data.png)

*screenshot (from gov.uk webpage) of some of the the available tables*

[Accessibility Statistics Guidance 2014](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/372139/accessibility-statistics-guidance.pdf)

### Theoretical framework

In a general (non-linear/linear) _regression model_ we have a given dependent variable which we try to explain by several independent/explanatory variables. <br/>
In our case for a LUR model we have, considering for example GHG emissions from mobility or housing:

| | | |
|-|-|-|
| Dependent variable     | actual data for GHG emissions       | |
| Explanatory variables  | landuse variables |(ex. n. of trips, distance, <br/> mode of transport...)  |

<br/><br/>

*Formulas here*
<br/><br/>
---

### Some literature on LUR

**Questions**

1. LUR is generally used for air quality prediction <br/>
_...FIND examples of non-air pollutants applications?_

2. LUR potential predictor variables extraction ... relevant for us? (limited number of variables)
$\rightarrow$ _ideally we'd like to perform this as well_

3. LUR output is raster VS vectorial $\rightarrow$ _we'll need to aggregate the data at some spatial level (MSOAs for instance), introducing some level of approximation_

4. not clear how the _spatial_ connotation enters the model, just because we use data defined at (some) geographic level? _YES_

---

- [https://en.wikipedia.org/wiki/Land_use_regression_model](https://en.wikipedia.org/wiki/Land_use_regression_model)
<blockquote>
A raster graphic image of the area is generated and intersected with area-level population data to formulate the exposure distribution.
</blockquote>

- [Hoek et al., 2008](https://www.sciencedirect.com/science/article/abs/pii/S1352231008005748) "A review of land-use regression models to assess spatial variation of outdoor air pollution" <br/>
They review 25 land-use regression studies.<br/>
<blockquote>
Application of the land-use regression approach for air pollution mapping was introduced in the SAVIAH (Small Area Variations In Air quality and Health) study (Briggs et al., 1997).  The technique was initially termed regression mapping
</blockquote>
<blockquote>
Land-use regression combines monitoring of air pollution at typically 20–100 locations, spread over the study area, and development of stochastic models using predictor variables usually obtained through geographic information systems (GIS)
</blockquote>
<blockquote>
main components of LUR: monitoring data, geographic predictors and model development and validation
</blockquote>

- [Bertazzon et al., 2015](https://www.sciencedirect.com/science/article/pii/S1877584515000325?via%3Dihub) "Accounting for spatial effects in land use regression for urban air pollution modeling"

<blockquote>
LUR models are described by standard regression equations. Over the past decade, land use regression (LUR) modeling has emerged as a preferred method for assessing exposure to spatially heterogeneous pollutants, including NO2 (Health Effects Institute, 2010). Despite their advantages, LUR models rely on spatial data; therefore, they are subject to the spatial effects associated with the properties of these data.
</blockquote>

- [Morley and Gulliber, 2018](https://github.com/dwmorley/RLUR)"A land use regression variable generation, modelling and prediction tool for air pollution exposure assessment"

<mark>RLUR</mark> software to develop LUR model in R;<br/>
Open-source code available in [GitHub](https://github.com/dwmorley/RLUR);<br/>
GUI with visualisation tools

- [Ma et al. 2020](https://www.researchgate.net/publication/339851484_PyLUR_Efficient_software_for_land_use_regression_modeling_the_spatial_distribution_of_air_pollutants_using_GDALOGR_library_in_Python) "<mark>PyLUR</mark>: efficient software for land use regression modelling the spatial distribution of air pollutants using GDAL/OGR library in Python"

<blockquote>
Although conceptually quite simple, its successful implementation requires detailed knowledge of the area, expertise in GIS, statistics, and programming skills, which makes this modelling approach **relatively inaccessible to novice users**.
</blockquote>

<blockquote>
PyLUR out-performs <mark>RLUR</mark> for modelling in the Bradford and Auckland case studies examined. Furthermore, PyLUR is much more efficient in data processing and it has a capability to handle detailed GIS input data.</blockquote>

<blockquote>
<sub><sup>The principles of LUR modelling can be summarized in **five steps**. **First**, air pollution monitoring and GIS data are collected within the scope of the study area. **Secondly**, different kinds of potential predictor variables for each site are generated using GIS buffering or other geospatial analysis methods. **Thirdly**, multiple regression analysis is carried out to develop one regression equation establishing the relationship between the observed air pollutant concentrations and significant predictor variables selected from a pool of all potential predictor variables. **Fourthly**, model performance is evaluated using holdout or cross-validation. **Finally*, once the model is successfully validated, it can be applied to predict the concentration at un-sampled points of interest or generate an air pollutant concentration map of the whole study area (Morley and Gulliver, 2018).</sup></sub>
</blockquote>

- [Molter and Lindley, 2021](https://www.sciencedirect.com/science/article/pii/S1364815221001511) "Developing land use regression models for environmental science research using the <mark>XLUR</mark> tool – More than a one-trick pony"

<blockquote>A Python toolbox for ArcGIS Pro that enables the development and application of land use regression models</blockquote>
... relevant for literature (it's developed for ArcGIS, so no use)

### LUR in Python

- check out this blog [How to Build a Regression Model in Python](https://towardsdatascience.com/how-to-build-a-regression-model-in-python-9a10685c7f09)

- Geographic Data Science with Python, book [Chap. 11, Spatial Regression](https://geographicdata.science/book/notebooks/11_regression.html)

- Paper [PyLUR: Efficient software for land use regression modeling the spatial distribution of air pollutants using GDAL/OGR library in Python](https://link.springer.com/article/10.1007/s11783-020-1221-5) <br/>
Note the code is available online on ResearchGate [here](https://www.researchgate.net/publication/339851484_PyLUR_Efficient_software_for_land_use_regression_modeling_the_spatial_distribution_of_air_pollutants_using_GDALOGR_library_in_Python) (find “linked data” tab)


### Facts on GHG emissions

Governmental report [UK local authority and regional greenhouse gas emissions national statistics, 2005 to 2020](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1086967/uk-local-regional-greenhouse-gas-emissions-2005-2020-release.pdf)


## October

**Initial trials**

Working on *a. mobility based emissions* $\rightarrow$ IE transport data

\&

Building *base scenario*

Roadmap:

- [X] Try to dl/open/visualise SPC data $\rightarrow$ *Note: study case Metropolitan county of Tyne and Wear*
- [ ] Investigate potentially relevant data from [UK Data Services](#people-behavior) data $\rightarrow$ any other relevant dataset?
- [ ] How to connect/integrate TUS to SPC dataset -- why?
- [ ] visualise the integrated dataset $\rightarrow$ *base scenario*
- [ ] think "future scenarios"

![](images/tynewear_county_lads.png)
*The 5 LADs in the Metropolitan County of Tyne and Wear, highlighted are also the 4 major town areas*


---

**Keep in mind when you'll "generalise" the procedure**

*IE pass from the study case to a national case*

- how to select MSOAs for Origin and Destination from the dataset (take off abroad destinations as well)

- 

---

### Defining relations

We can see the Indicators $I_{i}$, with $i = \{1, ..., n\}$, as a function of different land uses $l_{j}$ where $j = \{1, ..., k\}$ and $I_{i}$ can be expressed as generic mathematical relation (that we express with the symbol "$\star$"") between several $l_{j}$ weighted by $k$ generic weights/parameters $w_{j}$, as follows:

$$I_{i}(l) = w_1^il_{1} \star  w_2^il_{2} \dots \star w_k^il_{k}$$

Different indicators can depend on same landuse variables, and per each indicator the scenarios can be expressed by acting on the paramters $w_{j}$.

As an example, using the definition above the indicator Mobility based emissions (a.) could be expressed **for commuting trips** <mark>per mode of transport</mark> and per each MSOA as:

<!-- $[\textit{emissions/ msoa / year}] = w_1[trips/day] \star w_2[distance/trip] \star w_3[n\_individuals] \star w_4[n\_commuting days/year] \star w_5[\textit{CO}_2 \textit{k}]$ -->

$$
\begin{align}
[\textit{emissions/msoa/year}] & =  w_1[trips/day] \star\\
& \star  w_2[distance/trip] \star\\
& \star  w_3[n\_individuals] \star\\
& \star  w_4[\textit{n of commuting days/year}] \star \\
& \star w_5[\textit{CO}_2 \textit{k}]
\end{align}
$$

where:

- $[trips/day]$ is a fixed value (average per person from DFT data ... *)
- $[distance/trip]$ is calculated as shortest distance between the MSOAs' centroids
- $[n\_individuals]$ is given by the UK Census 2011 commuting flow
- $[\textit{n of commuting days/year}]$ is a fixed value (average per person from DFT data ... *)
- $[CO_2 k]$ is the carbon dioxide equivalent emission factor per mode of transport

### Working questions:

- [ ] which year to take into consideration for the analysis? (Census, conversion factors, surveys...)

- [ ] when I calculate the distance home-place of work, how do I consider the intraMSOA trips (IE within the same MSOA), as I am only taking into account the centroids of the MSOAs?

- [ ] how we count total number of people (age, people working)

- [ ] do we give the results per capita (then see point above) or total per MSOA

- [ ] how many hours for the working from home people (not counting for now, as not using transport)

---

### Approximations

a. only OD within MSOAs of this county 

b. considering as distance only the pop weighted centroids for each MSOA

c. London has specific values for CO2 conversion factors (ex for cabs, buses, underground) but only using general values (correct later if needed for London case)

d. ...

---

Commuting is really just one part of the total travels by car per per person per year:

![](images/car_trips_per_person_travel_survey.png)
*source: [national travel  survey](https://www.gov.uk/government/statistics/national-travel-survey-2020/national-travel-survey-2020)*

... it sounds then reductive to consider only commuting trips for emissions!

---

### Python code

**Note:** first trials in R, as I am more confident with the language, and trying to reproduce the code from carbun calculator for [prep_travel_to_work.R](https://github.com/creds2/CarbonCalculator/blob/master/R/prep_travel_to_work.R),

will then translate to Python

- Remember to add in *READ_ME* a walkthrough.

- Using `env.yml` $\dots$ *use `conda` or `poetry`?*



### Preliminary results

*Origin Destination flows of individuals for commuting to work (2011 UK Census data), the Metropolitan County of Tyne and Wear, separated by mode of transport*
![](images/od_tynewear_bymode.png)

*Preliminary results for GHG emissions from cars, total per MSOA per year in Tyne and Wear*
![](images/results_tynewear_car_emis_prelim.png)



## September

**Exploratory phase**

The idea is to focus on a few indicators (one or two) in order generate a *methodology* to apply to different variables (IE all the rest of indicators)

Concentrating on Indicators for [Net-zero a and b](intro.qmd#net-zero):

- a. *mobility based emissions* ... integration with SPC $/$ AB-street?

- b. *housing based emissions*


### Data availability

---

1. ~~(aggregated at LAD level) UK GHG emissions national statistics, estimates per Local Authority [Data for 2005 - 2020](https://www.gov.uk/government/statistics/uk-local-authority-and-regional-greenhouse-gas-emissions-national-statistics-2005-to-2020)~~ $\rightarrow$  this datum is a sum of emissions from 2005-2020


---

#### a. mobility based emissions

1. we can get from gov.uk CO<sub>2</sub>e (carbon dioxide equivalent) emissions factors for several occupations and travel modes, including transport, freight, etc [link](https://www.gov.uk/government/collections/government-conversion-factors-for-company-reporting);<br\>
We get the emission factors per mode of transport from the tab "Business travel-land" and "homeworking" (for working from home individuals)

2. OD flows from UK census ... **only to work and home**? *~~check source~~* $\rightarrow$ YES $\Downarrow$

3. get travel to school flow data from Propensity to Cycle Tool [PCT](https://www.pct.bike/m/)?

4. Location of usual residence and place of work by method of travel to work (...origin destination flows)
~~table WU03UK](https://wicid.ukdataservice.ac.uk/cider/wicid/downloads.php) at LAD level \
 *Note:* can download all the tables for "Location of usual residence and place of work by method of travel to work" at different levels (LAD to LSOA, though the lattest is not Open data) here https://wicid.ukdataservice.ac.uk/cider/about/data_int.php?type=2~~  <br\> **safeguarded data!!** git sttuslet's find <mark>MSOA</mark> data: <br\>
[nomisweb](Location of usual residence and place of work by method of travel to work)

- WU03BEW(with 'outside UK' detailed) **safeguarded**

- WU03EW (with 'outside UK' collapsed) **open**

---

#### b. housing based emissions
Sub-national electricity and gas consumption data, [overview link](https://www.gov.uk/government/statistical-data-sets/stacked-electricity-consumption-statistics-data)


- [electricity consumption](https://www.gov.uk/government/collections/sub-national-electricity-consumption-data):

a. one table per year (20105 to 2020) of total consumption at region and LAD levels [link](https://www.gov.uk/government/statistical-data-sets/regional-and-local-authority-electricity-consumption-statistics)

b. one table per year (2010 to 2020) of total consumption at LSOA or MSOA level [link](https://www.gov.uk/government/statistics/lower-and-middle-super-output-areas-electricity-consumption)

c. electricity and gas consumption (kWh) at postcode level (England, Scotland, Wales), one table per year, 2013,2015-2020 [Experimental](https://www.gov.uk/government/publications/postcode-level-domestic-gas-and-electricity-consumption-about-the-data)

d. electricity consumption data for 2005 to 2020 as a single table, with years stacked one above the other [stacked data](https://www.gov.uk/government/statistical-data-sets/stacked-electricity-consumption-statistics-data)

- analogous links for [gas consumption](https://www.gov.uk/government/collections/sub-national-gas-consumption-data) 

---

#### People behavior

People behavior and time use from *The UK Time Diary Study 2014 - 2015* - UK Time Use Survey carried by NatCen and available from [UK Data Service](https://ukdataservice.ac.uk/)

what we can get from this source: time people spend in different activities, mode of transport (yes?)

### Did someone already do this?


[carbon.place](https://www.carbon.place/)

Project from Malcom Morgan (Univ of Leeds) ...

> The PBCC estimates the average carbon footprint per person for each LSOA in England


**NOTE:**

cool project, GitHub code available but not reproducible (?)

opened issue here [https://github.com/creds2/CarbonCalculator/issues/6](https://github.com/creds2/CarbonCalculator/issues/6)




## Open general questions
*And plausible answer*


- [X] importance of localised emissions and need for air-flow modelling ... *not relevant for GHG*

- [X] what is the Research Question $\rightarrow$ *What are the "best" values in the parametrisation of the land use variables? Could we train the computer to predict these values?*

- [X] Resolution  ~~LSOAS/~~ *MSOAS* ? feedback from Dani regarding SS: *SS gives conversion to LSOAs* $\Downarrow$

- [X] how to generate scenarios - *ideas: change parameters' range/values, run ABstreet simulations...?*

- [X] integrate with SPC -  *need to integrate more Census variables? feasible?*

- [ ] Use SPC (individuals' level data) as we aggregate at MSOA level... what variables are meaningful when aggregated?

- [ ] can we actually build a methodology, given the different range of indicators and data?

- [ ] how turn on/off scenarios in the visualisation- *different layers in the map*

- [ ] type of output - *map, web ...* ~~MapBox~~ *MapLibre GL, Leaflet, ...*


---

### Output / map generation

Note: could generate a website via [MapLibre](https://maplibre.org/), checked the options

<!-- Let's see if [this map link](map_again.html) works  -->

<!-- What about a nested map

<link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/maplibre-gl-js-docs/assets/favicon/apple-touch-icon.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/maplibre-gl-js-docs/assets/favicon/favicon-32x32.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/maplibre-gl-js-docs/assets/favicon/favicon-16x16.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="manifest" href="/maplibre-gl-js-docs/assets/favicon/site.webmanifest?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="mask-icon" href="/maplibre-gl-js-docs/assets/favicon/safari-pinned-tab.svg?v=rMBbQAR5BL" color="#4264fb"/><link data-react-helmet="true" rel="shortcut icon" href="/maplibre-gl-js-docs/assets/favicon/favicon.ico?v=rMBbQAR5BL"/> -->
